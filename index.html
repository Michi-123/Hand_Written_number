<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>Handwritten Recognition — Mobile Tabs</title>
  <style>
    :root{
      --bg:#0b0b0c;
      --card:#15161a;
      --muted:#9aa3af;
      --text:#e5e7eb;
      --acc:#4ade80;
      --border:#2a2d34;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family: system-ui,-apple-system, Segoe UI, Roboto, Noto Sans JP, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      line-height:1.5;
    }
    .container{
      max-width: 1080px;
      margin: 0 auto;
      padding: 12px 12px 80px;
    }
    header{
      display:flex;align-items:center;justify-content:space-between;
      gap:12px;margin-bottom:12px;
    }
    header h1{font-size:18px;margin:0;font-weight:700;letter-spacing:.2px}
    .toolbar{
      display:flex;flex-wrap:wrap;gap:8px;align-items:center;
      background: var(--card); border:1px solid var(--border);
      padding:10px;border-radius:12px;
    }
    .toolbar .group{display:flex;gap:8px;align-items:center}
    .toolbar input[type="color"]{width:40px;height:32px;border:none;background:#0000}
    .btn{
      appearance:none;border:1px solid var(--border);background:#1b1d23;
      color:var(--text);padding:10px 14px;border-radius:12px;
      font-size:14px; font-weight:600; cursor:pointer
    }
    .btn:active{transform:translateY(1px)}
    .btn.primary{border-color:#1f2937;background:#111827}
    .btn.success{border-color:#144c2e;background:#0f3f25}
    .btn.warn{border-color:#5b3a02;background:#3a2801}
    .stack{display:flex;flex-direction:column;gap:10px}

    /* Canvas area */
    .canvas-card{
      background: var(--card); border:1px solid var(--border);
      border-radius: 14px; padding: 12px;
    }
    #canvas{
      display:block;margin:0 auto; background:#fff; border:1px solid #aaa;
      width:100%; max-width: 360px; height:auto; aspect-ratio:1/1;
    }
    #predicted{
      background:#fff;color:#111;width:120px;height:120px;
      text-align:center;font-size:72px;border:1px solid #ccc;
      display:flex;align-items:center;justify-content:center;border-radius:12px;
    }

    /* Top-level tabs (three panels) */
    .mtabs{margin-top:12px}
    .mtabs input[type=radio]{display:none}
    .mtab-bar{
      display:grid;grid-template-columns: 1fr 1fr 1fr; gap:8px;
      margin-bottom:10px;
    }
    .mtab-bar label{
      user-select:none;text-align:center;padding:10px 12px;border-radius:12px;
      border:1px solid var(--border);background:#1b1d23;color:var(--text);font-weight:700
    }
    #mt_data:checked ~ .mtab-bar label[for="mt_data"],
    #mt_train:checked ~ .mtab-bar label[for="mt_train"],
    #mt_infer:checked ~ .mtab-bar label[for="mt_infer"]{outline:2px solid var(--acc);}
    .panels > section{display:none}
    #mt_data:checked ~ .panels #panel_data{display:block}
    #mt_train:checked ~ .panels #panel_train{display:block}
    #mt_infer:checked ~ .panels #panel_infer{display:block}

    .card{
      background: var(--card); border:1px solid var(--border);
      border-radius: 14px; padding: 12px;
    }
    .grid{
      display:grid; gap:10px;
    }
    .grid-2{grid-template-columns: 1fr 1fr}
    .grid-3{grid-template-columns: repeat(3, 1fr)}
    @media (max-width: 900px){
      .grid-2,.grid-3{grid-template-columns: 1fr}
      #predicted{width:96px;height:96px;font-size:56px}
    }

    /* Existing analytics area (labels / graph / radio / indicator) */
    .analytics{
      display:grid; gap:10px; grid-template-columns: repeat(3, minmax(0,1fr));
    }
    .analytics .panel{background:#101217;border:1px solid var(--border);border-radius:12px;padding:8px;min-height:60px}
    @media (max-width: 640px){
      .analytics{grid-template-columns:1fr}
    }
    table{width:100%;border-collapse:collapse}
    td{padding:4px}
    .cell{ text-align:left; color:var(--muted); }
    .graph div.bar_graph{ height: 18px; background:#0ea5e9; border-radius:6px }
    .indicator{ width:0px; color:#f99; }
    #radio, #indicator, #graph{ width:100% }

    /* Softmax / batch-size toggle (kept for compatibility with main.js) */
    .toggle-bar{
      display:flex; gap:8px; flex-wrap:wrap; align-items:center;
      margin-top:6px;
    }
    .toggle-bar label{font-weight:600}
    input[type="radio"].tiny{ width:16px; height:16px }

    /* Inputs */
    .input, select{
      background:#111827;border:1px solid var(--border);color:var(--text);
      border-radius:10px;padding:8px 10px;font-size:14px
    }
    .inline{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .small{font-size:12px;color:var(--muted)}

    /* Footer outputs */
    .outputs{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>手書き認識 — スマホ対応</h1>
    </header>

    <!-- Drawing area (shared across tabs) -->
    <div class="canvas-card stack">
      <div class="toolbar">
        <div class="group">
          <label for="color" class="small">線の色</label>
          <input type="color" id="color" value="#77cc77">
        </div>
        <div class="group" style="margin-left:auto">
          <button class="btn" id="clear_canvas" type="button">Clear</button>
        </div>
      </div>
      <canvas id="canvas" width="280" height="280"></canvas>
    </div>

    <!-- Keep the existing softmax/batch-size toggle and analytics tables visible regardless of tab -->
    <div class="card">
      <div class="toggle-bar">
        <label for="tab_softmax">ソフトマックス</label>
        <input class="tiny" type="radio" name="tab" id="tab_softmax" value="softmax" checked>
        <label for="tab_batch_size">バッチサイズ</label>
        <input class="tiny" type="radio" name="tab" id="tab_batch_size" value="batch_size">
      </div>
      <div class="analytics" style="margin-top:10px">
        <div class="panel">
          <table id="label"></table>
        </div>
        <div class="panel">
          <table id="graph"></table>
        </div>
        <div class="panel">
          <table id="radio"></table>
          <table id="indicator" style="margin-top:6px"></table>
        </div>
      </div>
    </div>

    <!-- Main Tabs -->
    <div class="mtabs">
      <input type="radio" name="mainTab" id="mt_data" checked>
      <input type="radio" name="mainTab" id="mt_train">
      <input type="radio" name="mainTab" id="mt_infer">

      <div class="mtab-bar">
        <label for="mt_data">データ作成</label>
        <label for="mt_train">学習</label>
        <label for="mt_infer">推論</label>
      </div>

      <div class="panels">

        <!-- データ作成 -->
        <section id="panel_data" class="stack">
          <div class="card grid grid-2">
            <div class="stack">
              <label class="small" for="predict_type">種別</label>
              <select id="predict_type" class="input">
                <option value="0">数字</option>
                <option value="1">アルファベット</option>
                <option value="2">かな</option>
                <option value="3">記号</option>
              </select>
            </div>
            <div class="stack">
              <label class="small">操作</label>
              <div class="inline">
                <button class="btn success" id="add_btn" type="button">Add</button>
              </div>
            </div>
          </div>
          <p class="small">※ ラジオボタンでラベルを選んでから「Add」で現在のキャンバスをバッチに追加します。</p>
        </section>

        <!-- 学習 -->
        <section id="panel_train" class="stack">
          <div class="card grid grid-3">
            <div class="stack">
              <label class="small" for="learning_rate">学習率</label>
              <div class="inline">
                <input id="learning_rate" class="input" value="0.1" style="width:80px;text-align:right">
                <input type="range" id="learning_rate_range" min="0" max="5" style="flex:1">
              </div>
            </div>
            <div class="stack">
              <label class="small" for="epoch">エポック</label>
              <input id="epoch" class="input" value="1" style="width:80px;text-align:right">
            </div>
            <div class="stack">
              <label class="small">操作</label>
              <div class="inline">
                <button class="btn" id="init_weights" type="button">Init</button>
                <button class="btn warn" id="clear_batch" type="button">Clr Bat</button>
                <button class="btn primary" id="train_btn" type="button">Train</button>
              </div>
            </div>
          </div>
          <div class="outputs small">
            <div>loss: <span id="loss"></span></div>
          </div>
        </section>

        <!-- 推論 -->
        <section id="panel_infer" class="stack">
          <div class="card grid grid-2" style="align-items:center">
            <div class="inline">
              <button class="btn primary" id="predict" type="button">Predict</button>
            </div>
            <div class="inline" style="gap:16px">
              <div class="stack">
                <span class="small">Predict:</span>
                <div id="predicted"></div>
              </div>
              <div class="stack">
                <div class="small">H: <span id="hypothesis"> </span></div>
                <span id="hypothesis_all" style="display:none"></span>
              </div>
            </div>
          </div>
        </section>

      </div>
    </div>

  </div>

  <!-- Scripts: keep original IDs and filenames so existing JS continues to work -->
  <script type="text/javascript" src="canvas.js"></script>
  <script type="text/javascript" src="jquery.js"></script>

  <!-- Pretrained / initial weights (as in original) -->
  <script type="text/javascript" src="data/cW1.js"></script>
  <script type="text/javascript" src="data/cW2.js"></script>
  <script type="text/javascript" src="data/cb1.js"></script>
  <script type="text/javascript" src="data/cb2.js"></script>
  <script type="text/javascript" src="data/W1.js"></script>
  <script type="text/javascript" src="data/b1.js"></script>
  <script type="text/javascript" src="data/W2.js"></script>
  <script type="text/javascript" src="data/b2.js"></script>

  <!-- Core logic -->
  <script type="text/javascript" src="network.js"></script>
  <script type="text/javascript" src="main.js"></script>

  <script>
    // Optional: remember selected main tab
    (function(){
      const radios = document.querySelectorAll('input[name="mainTab"]');
      const key = 'hw_mobile_mainTab';
      const saved = localStorage.getItem(key);
      if(saved){
        const el = document.getElementById(saved);
        if(el) el.checked = true;
      }
      radios.forEach(r => r.addEventListener('change', ()=>{
        localStorage.setItem(key, r.id);
      }));
    })();
  </script>
</body>
</html>
