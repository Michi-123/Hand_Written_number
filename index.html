<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Hand written recognition — Mobile Ready</title>
<style>
  :root {
    --gap: 12px;
    --pad: 12px;
  }
  html, body { height: 100%; }
  body {
    background: #f7f7f7;
    margin: 0;
    padding: var(--pad);
    font-family: system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
    color: #222;
  }

  /* Toolbar */
  .toolbar-table { width: 100%; border-collapse: collapse; margin-bottom: var(--gap); }
  .toolbar-table td { padding: 8px; background: #eee; }
  #toolbar { background: #e0e0e0; }

  /* Canvas + side panes */
  .layout { display: grid; grid-template-columns: 1fr; gap: var(--gap); align-items: start; }

  canvas {
    background: #fff;
    border: 1px solid #aaa;
    border-radius: 8px;
    width: min(92vw, 360px);   /* responsive display size */
    height: auto;               /* keep aspect ratio */
    touch-action: none;         /* prevent scroll while drawing */
  }

  #predicted{
    background-color: #fff;
    border: solid 1px #ccc;
    border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    width: min(32vw, 160px);
    height: min(32vw, 160px);
    font-size: min(18vw, 72px);
    margin: 6px 0;
  }
  #hypothesis { min-height: 24px; }

  /* Buttons & inputs = larger tap targets */
  input[type="button"], input[type="range"], select, input[type="color"], #learning_rate, #epoch {
    font-size: 16px; /* avoid iOS zoom */
  }
  input[type="button"], #predict, #clear_canvas, #train_btn, #add_btn, #init_weights, #clear_batch {
    padding: 10px 14px; border-radius: 8px; border: 1px solid #bbb; background: #fff; min-height: 44px;
  }

  /* Tables that JS depends on keep their IDs, but we make them scrollable on small screens */
  #label, #graph, #radio, #indicator { background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 6px; }
  #graph .bar_graph { background-color: #00cc00; height: 12px; border-radius: 6px; }

  /* Compact table look */
  table { border-collapse: collapse; }
  td.cell { text-align: center; padding: 4px 6px; }

  /* Mobile layout */
  @media (max-width: 720px) {
    .toolbar-table td { display: block; width: 100%; }
    .buttons-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }

    /* Focus on key UI for phones */
    #label { display: none; }
    /* #radio and #indicator default hidden already; keep hidden on phones. */

    /* Make slider full width */
    #learning_rate_range { width: 100%; max-width: 420px; }
  }

  /* Desktop tweaks */
  @media (min-width: 721px) {
    .layout { grid-template-columns: auto auto auto auto auto; }
    canvas { width: 280px; }
    #predicted { width: 120px; height: 120px; font-size: 80px; }
  }
</style>
</head>
<body>

<table class="toolbar-table">
  <tr id="toolbar">
    <td>
      <label for="predict_type" style="display:block;font-size:14px;margin-bottom:4px;">種別</label>
      <select id="predict_type">
        <option value="0">数字</option>
        <option value="1">アルファベット</option>
        <option value="2">かな</option>
        <option value="3">記号</option>
      </select>
    </td>
    <td>
      <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
        <label for="learning_rate" style="white-space:nowrap;">学習率</label>
        <input id="learning_rate" value="0.1" inputmode="decimal" />
        <input type="range" id="learning_rate_range" min="0" max="5" />
      </div>
    </td>
    <td>
      <label for="epoch" style="white-space:nowrap;">エポック</label>
      <input id="epoch" value="1" inputmode="numeric" />
    </td>
    <td class="tab">
      <label for="tab_softmax">ソフトマックス</label>
      <input type="radio" name="tab" id="tab_softmax" value="softmax" checked />
    </td>
    <td class="tab">
      <label for="tab_batch_size">バッチサイズ</label>
      <input type="radio" name="tab" id="tab_batch_size" value="batch_size" />
    </td>
  </tr>
</table>

<form name="form1">
  <div class="layout">
    <!-- Column 1: Canvas -->
    <div>
      <canvas id="canvas" width="280" height="280"></canvas>
      <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
        <input type="color" id="color" value="#77cc77" aria-label="ペン色" />
        <input type="button" id="predict" value="Predict" />
        <input type="button" id="clear_canvas" value=" Clear " />
      </div>

      <div class="buttons-row" style="margin-top:6px;">
        <input type="button" id="init_weights" value=" Init " />
        <input type="button" id="clear_batch" value="Clr Bat" />
        <input type="button" id="add_btn" value="  Add  " />
        <input type="button" id="train_btn" value=" Train " />
      </div>
    </div>

    <!-- Column 2: Labels (hidden on small screens but kept for JS) -->
    <table id="label">
      <tr><td class="cell cellnum0">0</td></tr>
      <tr><td class="cell cellnum1">1</td></tr>
      <tr><td class="cell cellnum2">2</td></tr>
      <tr><td class="cell cellnum3">3</td></tr>
      <tr><td class="cell cellnum4">4</td></tr>
      <tr><td class="cell cellnum5">5</td></tr>
      <tr><td class="cell cellnum6">6</td></tr>
      <tr><td class="cell cellnum7">7</td></tr>
      <tr><td class="cell cellnum8">8</td></tr>
      <tr><td class="cell cellnum9">9</td></tr>
    </table>

    <!-- Column 3: Graph (default visible) -->
    <table id="graph">
      <tr><td class="graph n0"></td></tr>
      <tr><td class="graph n1"></td></tr>
      <tr><td class="graph n2"></td></tr>
      <tr><td class="graph n3"></td></tr>
      <tr><td class="graph n4"></td></tr>
      <tr><td class="graph n5"></td></tr>
      <tr><td class="graph n6"></td></tr>
      <tr><td class="graph n7"></td></tr>
      <tr><td class="graph n8"></td></tr>
      <tr><td class="graph n9"></td></tr>
    </table>

    <!-- Column 4: Radio (kept for JS; hidden by default) -->
    <table id="radio" style="display:none;">
      <tr><td><input type="radio" name="num" value="0" /></td></tr>
      <tr><td><input type="radio" name="num" value="1" /></td></tr>
      <tr><td><input type="radio" name="num" value="2" /></td></tr>
      <tr><td><input type="radio" name="num" value="3" /></td></tr>
      <tr><td><input type="radio" name="num" value="4" /></td></tr>
      <tr><td><input type="radio" name="num" value="5" /></td></tr>
      <tr><td><input type="radio" name="num" value="6" /></td></tr>
      <tr><td><input type="radio" name="num" value="7" /></td></tr>
      <tr><td><input type="radio" name="num" value="8" /></td></tr>
      <tr><td><input type="radio" name="num" value="9" /></td></tr>
    </table>

    <!-- Column 5: Indicator (kept for JS; hidden by default) -->
    <table id="indicator" style="display:none;">
      <tr><td class="indicator n0">&nbsp;</td></tr>
      <tr><td class="indicator n1">&nbsp;</td></tr>
      <tr><td class="indicator n2">&nbsp;</td></tr>
      <tr><td class="indicator n3">&nbsp;</td></tr>
      <tr><td class="indicator n4">&nbsp;</td></tr>
      <tr><td class="indicator n5">&nbsp;</td></tr>
      <tr><td class="indicator n6">&nbsp;</td></tr>
      <tr><td class="indicator n7">&nbsp;</td></tr>
      <tr><td class="indicator n8">&nbsp;</td></tr>
      <tr><td class="indicator n9">&nbsp;</td></tr>
    </table>
  </div>

  <div style="margin-top:8px; display:grid; grid-template-columns: auto 1fr; align-items: center; gap: 8px;">
    <span>Predict:</span>
    <div id="predicted"></div>
    <span>H:</span>
    <span id="hypothesis"> </span>
  </div>
  <span id="hypothesis_all" style="display:none"></span><br />
  loss:<span id="loss"></span><br />
</form>

<!-- Scripts -->
<script src="canvas.js"></script>
<script src="jquery.js"></script>
<script src="data/cW1.js"></script>
<script src="data/cW2.js"></script>
<script src="data/cb1.js"></script>
<script src="data/cb2.js"></script>
<script src="data/W1.js"></script>
<script src="data/b1.js"></script>
<script src="data/W2.js"></script>
<script src="data/b2.js"></script>
<script src="network.js"></script>
<script src="main.js"></script>

<script>
  // ===== Mobile drawing support (adds touch events; keeps existing JS intact) =====
  (function(){
    if (!window.canvas) return; // canvas.js defines global `canvas` & `ctx`

    const toMouseLikeEvent = (e) => {
      const t = e.touches && e.touches[0] ? e.touches[0] : (e.changedTouches ? e.changedTouches[0] : e);
      return { clientX: t.clientX, clientY: t.clientY, target: canvas };
    };

    // Start drawing
    canvas.addEventListener('touchstart', function(e){
      e.preventDefault();
      window.drawing = true; // uses global from canvas.js
      const p = toMouseLikeEvent(e);
      const rect = p.target.getBoundingClientRect();
      window.before_x = p.clientX - rect.left;
      window.before_y = p.clientY - rect.top;
    }, { passive: false });

    // Draw while moving
    canvas.addEventListener('touchmove', function(e){
      e.preventDefault();
      if (!window.drawing) return;
      const p = toMouseLikeEvent(e);
      if (typeof draw_canvas === 'function') draw_canvas(p);
    }, { passive: false });

    // End drawing
    canvas.addEventListener('touchend', function(e){
      e.preventDefault();
      window.drawing = false;
    }, { passive: false });
  })();
</script>
</body>
</html>
